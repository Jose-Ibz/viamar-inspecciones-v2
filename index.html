<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NÃ¡utica Viamar - Sistema de Inspecciones</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f5f5f5;padding:20px}
.container{max-width:1400px;margin:0 auto;background:white;padding:30px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
h1{color:#003d82;margin-bottom:20px;text-align:center}
.tabs{display:flex;gap:10px;margin-bottom:30px;border-bottom:2px solid #ddd}
.tab{padding:15px 30px;cursor:pointer;border:none;background:none;font-size:16px;color:#666;border-bottom:3px solid transparent;transition:all 0.3s}
.tab.active{color:#003d82;border-bottom-color:#003d82;font-weight:bold}
.tab-content{display:none}
.tab-content.active{display:block}
.form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:20px}
.form-group{display:flex;flex-direction:column}
.form-group label{font-weight:bold;margin-bottom:5px;color:#333;font-size:14px}
.form-group input,.form-group select,.form-group textarea{padding:10px;border:1px solid #ddd;border-radius:4px;font-size:14px}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#003d82}
.section{margin-bottom:30px;padding:20px;background:#f9f9f9;border-radius:8px}
.section-title{font-size:18px;color:#003d82;margin-bottom:15px;font-weight:bold;border-bottom:2px solid #003d82;padding-bottom:10px}
.checklist{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px}
.check-item{display:flex;align-items:center;padding:10px;background:white;border-radius:4px;border:1px solid #ddd}
.check-item input[type="checkbox"]{margin-right:10px;width:20px;height:20px;cursor:pointer}
.check-item label{cursor:pointer;flex:1;font-size:14px}
.check-item.with-note{border-left:3px solid #ffa500}
.check-item.imported{background:#e8f5e9;border-left:3px solid #4caf50}
.note-btn,.gauge-btn{padding:5px 10px;font-size:12px;background:#003d82;color:white;border:none;border-radius:4px;cursor:pointer;margin-left:10px}
.note-btn:hover,.gauge-btn:hover{background:#002656}
.buttons{display:flex;gap:15px;margin-top:30px;justify-content:center}
.btn{padding:15px 40px;font-size:16px;border:none;border-radius:4px;cursor:pointer;font-weight:bold;transition:all 0.3s}
.btn-primary{background:#003d82;color:white}
.btn-primary:hover{background:#002656}
.btn-secondary{background:#666;color:white}
.btn-secondary:hover{background:#444}
.btn-success{background:#4caf50;color:white}
.btn-success:hover{background:#45a049}
.message-area{margin:20px 0;padding:15px;border-radius:4px;display:none}
.message-area.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
.message-area.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
.loading{display:none;text-align:center;padding:20px;font-size:18px;color:#003d82}
.import-section{margin:20px 0;padding:20px;background:#fff3cd;border:2px solid #ffc107;border-radius:8px;display:none}
.import-alert h4{color:#856404;margin-bottom:10px}
.import-btn{background:#ffc107;color:#000;padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-weight:bold;margin-top:10px}
.import-btn:hover{background:#e0a800}
.history-list{display:grid;gap:15px}
.history-item{padding:15px;background:white;border:1px solid #ddd;border-radius:4px;display:grid;grid-template-columns:auto 1fr auto auto;gap:15px;align-items:center}
.history-item.cerrada{opacity:0.6;background:#f5f5f5}
.history-date{font-weight:bold;color:#003d82}
.history-info{font-size:14px;color:#666}
.history-btn{padding:8px 15px;font-size:14px;background:#003d82;color:white;border:none;border-radius:4px;cursor:pointer}
.history-btn:hover{background:#002656}
.photo-section{margin-top:20px}
.photo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px;margin-top:15px}
.photo-item{border:2px dashed #ddd;border-radius:8px;padding:15px;text-align:center;position:relative}
.photo-item.has-photo{border-color:#4caf50;background:#f1f8f4}
.photo-item input[type="file"]{display:none}
.photo-item label{cursor:pointer;display:block;color:#003d82;font-size:14px;font-weight:bold}
.photo-preview{max-width:100%;max-height:150px;margin-top:10px;border-radius:4px}
.photo-remove{position:absolute;top:5px;right:5px;background:#f44336;color:white;border:none;border-radius:50%;width:25px;height:25px;cursor:pointer;font-size:12px}
.medidores-section{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
.medidor-group{background:white;padding:15px;border-radius:8px;border:1px solid #ddd}
.medidor-group h4{color:#003d82;margin-bottom:15px;text-align:center;border-bottom:2px solid #003d82;padding-bottom:10px}
.medidor-item{margin-bottom:10px}
.medidor-item label{font-size:13px;color:#666;display:block;margin-bottom:5px}
.medidor-item input{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px}
.char-counter{font-size:12px;color:#666;text-align:right;margin-top:5px}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5)}
.modal-content{background:white;margin:50px auto;padding:30px;width:90%;max-width:600px;border-radius:8px;max-height:80vh;overflow-y:auto}
.modal-close{float:right;font-size:28px;font-weight:bold;color:#666;cursor:pointer}
.modal-close:hover{color:#000}
@media(max-width:768px){
.form-row{grid-template-columns:1fr}
.medidores-section{grid-template-columns:1fr}
.history-item{grid-template-columns:1fr;text-align:center}
}
</style>
</head>
<body>
<div class="container">
<h1>ğŸš¤ NÃUTICA VIAMAR - SISTEMA DE INSPECCIONES</h1>

<div id="login-section">
<div class="section">
<div class="section-title">Iniciar SesiÃ³n</div>
<div class="form-row">
<div class="form-group">
<label>Usuario:</label>
<input type="text" id="username" placeholder="Usuario">
</div>
<div class="form-group">
<label>ContraseÃ±a:</label>
<input type="password" id="password" placeholder="ContraseÃ±a">
</div>
</div>
<div class="buttons">
<button class="btn btn-primary" onclick="login()">ENTRAR</button>
</div>
<div id="login-message" class="message-area"></div>
</div>
</div>

<div id="main-section" style="display:none">
<div style="text-align:right;margin-bottom:20px">
<span style="color:#003d82;font-weight:bold">Usuario: <span id="current-user"></span></span>
<button class="btn btn-secondary" onclick="logout()" style="margin-left:20px;padding:10px 20px">CERRAR SESIÃ“N</button>
</div>

<div class="tabs">
<button class="tab active" onclick="showTab('nueva')">NUEVA INSPECCIÃ“N</button>
<button class="tab" onclick="showTab('historial')">HISTORIAL</button>
</div>

<div id="tab-nueva" class="tab-content active">
<div class="section">
<div class="section-title">Datos Generales</div>
<div class="form-row">
<div class="form-group">
<label>EmbarcaciÃ³n *</label>
<input type="text" id="boat-name" required>
</div>
<div class="form-group">
<label>Modelo</label>
<input type="text" id="modelo">
</div>
<div class="form-group">
<label>Tipo de InspecciÃ³n *</label>
<select id="inspection-type" onchange="checkVarada()">
<option value="">Seleccionar...</option>
<option value="varada">VARADA</option>
<option value="botadura">BOTADURA</option>
</select>
</div>
<div class="form-group">
<label>NÂº Cliente</label>
<input type="text" id="cliente">
</div>
</div>

<div class="form-row">
<div class="form-group">
<label>Motores (descripciÃ³n)</label>
<input type="text" id="motores">
</div>
<div class="form-group">
<label>Colas</label>
<input type="text" id="colas">
</div>
<div class="form-group">
<label>Paso HÃ©lice</label>
<input type="text" id="paso-helice">
</div>
<div class="form-group">
<label>Amarre</label>
<input type="text" id="amarre">
</div>
</div>

<div class="form-row">
<div class="form-group">
<label>NÂº Motor Babor</label>
<input type="text" id="motor-babor">
</div>
<div class="form-group">
<label>NÂº Motor Estribor</label>
<input type="text" id="motor-estribor">
</div>
<div class="form-group">
<label>NÂº Motor Central</label>
<input type="text" id="motor-central">
</div>
</div>

<div class="form-row">
<div class="form-group">
<label>Motor Auxiliar NÂº</label>
<input type="text" id="motor-aux-num">
</div>
<div class="form-group">
<label>Motor Auxiliar Modelo</label>
<input type="text" id="motor-aux-modelo">
</div>
<div class="form-group">
<label>NÂº Llaves</label>
<input type="text" id="llaves">
</div>
<div class="form-group">
<label>Cabina</label>
<input type="text" id="cabina">
</div>
</div>

<div class="form-row">
<div class="form-group">
<label>Fecha Varada</label>
<input type="date" id="date-varada">
</div>
<div class="form-group">
<label>Fecha Botadura</label>
<input type="date" id="date-botadura">
</div>
</div>
</div>

<div id="import-section" class="import-section"></div>

<div id="checklist-previo-section" class="section" style="display:none">
<div class="section-title">Checklist Previo (Solo Varada)</div>
<div class="checklist">

<div class="check-item" id="cp0-item">
<input type="checkbox" id="cp0" onchange="updateCheck('cp0')">
<label for="cp0">Pasar motores por agua dulce</label>
</div>

<div class="check-item" id="cp1-item">
<input type="checkbox" id="cp1" onchange="updateCheck('cp1')">
<label for="cp1">Pasar motor auxiliar por agua dulce</label>
</div>

<div class="check-item" id="cp2-item">
<input type="checkbox" id="cp2" onchange="updateCheck('cp2')">
<label for="cp2">Cambiar aceite motor</label>
</div>

<div class="check-item" id="cp3-item">
<input type="checkbox" id="cp3" onchange="updateCheck('cp3')">
<label for="cp3">Cambiar aceite colas</label>
</div>

<div class="check-item" id="cp4-item">
<input type="checkbox" id="cp4" onchange="updateCheck('cp4')">
<label for="cp4">Invernar generador</label>
</div>

<div class="check-item" id="cp5-item">
<input type="checkbox" id="cp5" onchange="updateCheck('cp5')">
<label for="cp5">Invernar aire acondicionado</label>
</div>

<div class="check-item" id="cp6-item">
<input type="checkbox" id="cp6" onchange="updateCheck('cp6')">
<label for="cp6">TensiÃ³n correas</label>
</div>

<div class="check-item" id="cp7-item">
<input type="checkbox" id="cp7" onchange="updateCheck('cp7')">
<label for="cp7">Revisar combustible</label>
</div>

<div class="check-item" id="cp8-item">
<input type="checkbox" id="cp8" onchange="updateCheck('cp8')">
<label for="cp8">Revisar niveles agua</label>
</div>

<div class="check-item" id="cp9-item">
<input type="checkbox" id="cp9" onchange="updateCheck('cp9')">
<label for="cp9">Revisar niveles aceite</label>
</div>

<div class="check-item" id="cp10-item">
<input type="checkbox" id="cp10" onchange="updateCheck('cp10')">
<label for="cp10">Vaciar tanque aguas negras</label>
</div>

</div>
</div>

<div class="section">
<div class="section-title">Verificaciones (52 items)</div>
<div class="checklist">

<div class="check-item" id="v0-item">
<input type="checkbox" id="v0" onchange="updateCheck('v0')">
<label for="v0">Fotos, sobre todo lo defectuoso</label>
<button class="note-btn" onclick="openNoteModal('v0')">ğŸ“</button>
</div>

<div class="check-item" id="v1-item">
<input type="checkbox" id="v1" onchange="updateCheck('v1')">
<label for="v1">Limpieza de sentinas</label>
<button class="note-btn" onclick="openNoteModal('v1')">ğŸ“</button>
</div>

<div class="check-item" id="v2-item">
<input type="checkbox" id="v2" onchange="updateCheck('v2')">
<label for="v2">Sistema direcciÃ³n</label>
<button class="note-btn" onclick="openNoteModal('v2')">ğŸ“</button>
</div>

<div class="check-item" id="v3-item">
<input type="checkbox" id="v3" onchange="updateCheck('v3')">
<label for="v3">Mandos</label>
<button class="note-btn" onclick="openNoteModal('v3')">ğŸ“</button>
</div>

<div class="check-item" id="v4-item">
<input type="checkbox" id="v4" onchange="updateCheck('v4')">
<label for="v4">PresiÃ³n aceite motor</label>
<button class="note-btn" onclick="openNoteModal('v4')">ğŸ“</button>
</div>

<div class="check-item" id="v5-item">
<input type="checkbox" id="v5" onchange="updateCheck('v5')">
<label for="v5">PresiÃ³n IPS</label>
<button class="note-btn" onclick="openNoteModal('v5')">ğŸ“</button>
</div>

<div class="check-item" id="v6-item">
<input type="checkbox" id="v6" onchange="updateCheck('v6')">
<label for="v6">AmperÃ­metro</label>
<button class="note-btn" onclick="openNoteModal('v6')">ğŸ“</button>
</div>

<div class="check-item" id="v7-item">
<input type="checkbox" id="v7" onchange="updateCheck('v7')">
<label for="v7">VoltÃ­metro</label>
<button class="note-btn" onclick="openNoteModal('v7')">ğŸ“</button>
</div>

<div class="check-item" id="v8-item">
<input type="checkbox" id="v8" onchange="updateCheck('v8')">
<label for="v8">Temperatura motor</label>
<button class="note-btn" onclick="openNoteModal('v8')">ğŸ“</button>
</div>

<div class="check-item" id="v9-item">
<input type="checkbox" id="v9" onchange="updateCheck('v9')">
<label for="v9">Temperatura IPS</label>
<button class="note-btn" onclick="openNoteModal('v9')">ğŸ“</button>
</div>

<div class="check-item" id="v10-item">
<input type="checkbox" id="v10" onchange="updateCheck('v10')">
<label for="v10">Indicador trim</label>
<button class="note-btn" onclick="openNoteModal('v10')">ğŸ“</button>
</div>

<div class="check-item" id="v11-item">
<input type="checkbox" id="v11" onchange="updateCheck('v11')">
<label for="v11">Power trim</label>
<button class="note-btn" onclick="openNoteModal('v11')">ğŸ“</button>
</div>

<div class="check-item" id="v12-item">
<input type="checkbox" id="v12" onchange="updateCheck('v12')">
<label for="v12">Flaps hidrÃ¡ulicos</label>
<button class="note-btn" onclick="openNoteModal('v12')">ğŸ“</button>
</div>

<div class="check-item" id="v13-item">
<input type="checkbox" id="v13" onchange="updateCheck('v13')">
<label for="v13">Toma tierra y cableado</label>
<button class="note-btn" onclick="openNoteModal('v13')">ğŸ“</button>
</div>

<div class="check-item" id="v14-item">
<input type="checkbox" id="v14" onchange="updateCheck('v14')">
<label for="v14">InstalaciÃ³n 220V</label>
<button class="note-btn" onclick="openNoteModal('v14')">ğŸ“</button>
</div>

<div class="check-item" id="v15-item">
<input type="checkbox" id="v15" onchange="updateCheck('v15')">
<label for="v15">Funcionamiento generador</label>
<button class="note-btn" onclick="openNoteModal('v15')">ğŸ“</button>
</div>

<div class="check-item" id="v16-item">
<input type="checkbox" id="v16" onchange="updateCheck('v16')">
<label for="v16">Velocidad nudos</label>
<button class="note-btn" onclick="openNoteModal('v16')">ğŸ“</button>
</div>

<div class="check-item" id="v17-item">
<input type="checkbox" id="v17" onchange="updateCheck('v17')">
<label for="v17">IluminaciÃ³n instrumentos</label>
<button class="note-btn" onclick="openNoteModal('v17')">ğŸ“</button>
</div>

<div class="check-item" id="v18-item">
<input type="checkbox" id="v18" onchange="updateCheck('v18')">
<label for="v18">Indicador combustible</label>
<button class="note-btn" onclick="openNoteModal('v18')">ğŸ“</button>
</div>

<div class="check-item" id="v19-item">
<input type="checkbox" id="v19" onchange="updateCheck('v19')">
<label for="v19">Extractor gases</label>
<button class="note-btn" onclick="openNoteModal('v19')">ğŸ“</button>
</div>

<div class="check-item" id="v20-item">
<input type="checkbox" id="v20" onchange="updateCheck('v20')">
<label for="v20">Molinete</label>
<button class="note-btn" onclick="openNoteModal('v20')">ğŸ“</button>
</div>

<div class="check-item" id="v21-item">
<input type="checkbox" id="v21" onchange="updateCheck('v21')">
<label for="v21">Bombas achique y automÃ¡ticos</label>
<button class="note-btn" onclick="openNoteModal('v21')">ğŸ“</button>
</div>

<div class="check-item" id="v22-item">
<input type="checkbox" id="v22" onchange="updateCheck('v22')">
<label for="v22">Corredera</label>
<button class="note-btn" onclick="openNoteModal('v22')">ğŸ“</button>
</div>

<div class="check-item" id="v23-item">
<input type="checkbox" id="v23" onchange="updateCheck('v23')">
<label for="v23">Funcionamiento aire acondicionado</label>
<button class="note-btn" onclick="openNoteModal('v23')">ğŸ“</button>
</div>

<div class="check-item" id="v24-item">
<input type="checkbox" id="v24" onchange="updateCheck('v24')">
<label for="v24">BaterÃ­as</label>
<button class="note-btn" onclick="openNoteModal('v24')">ğŸ“</button>
</div>

<div class="check-item" id="v25-item">
<input type="checkbox" id="v25" onchange="updateCheck('v25')">
<label for="v25">Limpieza motores</label>
<button class="note-btn" onclick="openNoteModal('v25')">ğŸ“</button>
</div>

<div class="check-item" id="v26-item">
<input type="checkbox" id="v26" onchange="updateCheck('v26')">
<label for="v26">Limpiaparabrisas</label>
<button class="note-btn" onclick="openNoteModal('v26')">ğŸ“</button>
</div>

<div class="check-item" id="v27-item">
<input type="checkbox" id="v27" onchange="updateCheck('v27')">
<label for="v27">Funcionamiento WC</label>
<button class="note-btn" onclick="openNoteModal('v27')">ğŸ“</button>
</div>

<div class="check-item" id="v28-item">
<input type="checkbox" id="v28" onchange="updateCheck('v28')">
<label for="v28">Claxon</label>
<button class="note-btn" onclick="openNoteModal('v28')">ğŸ“</button>
</div>

<div class="check-item" id="v29-item">
<input type="checkbox" id="v29" onchange="updateCheck('v29')">
<label for="v29">Grifos de fondo</label>
<button class="note-btn" onclick="openNoteModal('v29')">ğŸ“</button>
</div>

<div class="check-item" id="v30-item">
<input type="checkbox" id="v30" onchange="updateCheck('v30')">
<label for="v30">Grifos y duchas</label>
<button class="note-btn" onclick="openNoteModal('v30')">ğŸ“</button>
</div>

<div class="check-item" id="v31-item">
<input type="checkbox" id="v31" onchange="updateCheck('v31')">
<label for="v31">Nevera/s</label>
<button class="note-btn" onclick="openNoteModal('v31')">ğŸ“</button>
</div>

<div class="check-item" id="v32-item">
<input type="checkbox" id="v32" onchange="updateCheck('v32')">
<label for="v32">Microondas</label>
<button class="note-btn" onclick="openNoteModal('v32')">ğŸ“</button>
</div>

<div class="check-item" id="v33-item">
<input type="checkbox" id="v33" onchange="updateCheck('v33')">
<label for="v33">VHF, mÃºsica y navegaciÃ³n</label>
<button class="note-btn" onclick="openNoteModal('v33')">ğŸ“</button>
</div>

<div class="check-item" id="v34-item">
<input type="checkbox" id="v34" onchange="updateCheck('v34')">
<label for="v34">Televisor</label>
<button class="note-btn" onclick="openNoteModal('v34')">ğŸ“</button>
</div>

<div class="check-item" id="v35-item">
<input type="checkbox" id="v35" onchange="updateCheck('v35')">
<label for="v35">Cocina</label>
<button class="note-btn" onclick="openNoteModal('v35')">ğŸ“</button>
</div>

<div class="check-item" id="v36-item">
<input type="checkbox" id="v36" onchange="updateCheck('v36')">
<label for="v36">Escotillas</label>
<button class="note-btn" onclick="openNoteModal('v36')">ğŸ“</button>
</div>

<div class="check-item" id="v37-item">
<input type="checkbox" id="v37" onchange="updateCheck('v37')">
<label for="v37">Luces navegaciÃ³n</label>
<button class="note-btn" onclick="openNoteModal('v37')">ğŸ“</button>
</div>

<div class="check-item" id="v38-item">
<input type="checkbox" id="v38" onchange="updateCheck('v38')">
<label for="v38">Luces interior/exterior</label>
<button class="note-btn" onclick="openNoteModal('v38')">ğŸ“</button>
</div>

<div class="check-item" id="v39-item">
<input type="checkbox" id="v39" onchange="updateCheck('v39')">
<label for="v39">RasguÃ±os casco</label>
<button class="note-btn" onclick="openNoteModal('v39')">ğŸ“</button>
</div>

<div class="check-item" id="v40-item">
<input type="checkbox" id="v40" onchange="updateCheck('v40')">
<label for="v40">Moquetas</label>
<button class="note-btn" onclick="openNoteModal('v40')">ğŸ“</button>
</div>

<div class="check-item" id="v41-item">
<input type="checkbox" id="v41" onchange="updateCheck('v41')">
<label for="v41">Toldos y lonas</label>
<button class="note-btn" onclick="openNoteModal('v41')">ğŸ“</button>
</div>

<div class="check-item" id="v42-item">
<input type="checkbox" id="v42" onchange="updateCheck('v42')">
<label for="v42">Â¿Lleva motor auxiliar?</label>
<button class="note-btn" onclick="openNoteModal('v42')">ğŸ“</button>
</div>

<div class="check-item" id="v43-item">
<input type="checkbox" id="v43" onchange="updateCheck('v43')">
<label for="v43">Â¿Lleva neumÃ¡tica?</label>
<button class="note-btn" onclick="openNoteModal('v43')">ğŸ“</button>
</div>

<div class="check-item" id="v44-item">
<input type="checkbox" id="v44" onchange="updateCheck('v44')">
<label for="v44">NÃºmero de boyas</label>
<button class="note-btn" onclick="openNoteModal('v44')">ğŸ“</button>
</div>

<div class="check-item" id="v45-item">
<input type="checkbox" id="v45" onchange="updateCheck('v45')">
<label for="v45">Detallar cabos amarre/muelles</label>
<button class="note-btn" onclick="openNoteModal('v45')">ğŸ“</button>
</div>

<div class="check-item" id="v46-item">
<input type="checkbox" id="v46" onchange="updateCheck('v46')">
<label for="v46">EscalÃ³n pantalÃ¡n</label>
<button class="note-btn" onclick="openNoteModal('v46')">ğŸ“</button>
</div>

<div class="check-item" id="v47-item">
<input type="checkbox" id="v47" onchange="updateCheck('v47')">
<label for="v47">Pasarela</label>
<button class="note-btn" onclick="openNoteModal('v47')">ğŸ“</button>
</div>

<div class="check-item" id="v48-item">
<input type="checkbox" id="v48" onchange="updateCheck('v48')">
<label for="v48">PÃ©rdidas aceite/agua</label>
<button class="note-btn" onclick="openNoteModal('v48')">ğŸ“</button>
</div>

<div class="check-item" id="v49-item">
<input type="checkbox" id="v49" onchange="updateCheck('v49')">
<label for="v49">HÃ©lice proa</label>
<button class="note-btn" onclick="openNoteModal('v49')">ğŸ“</button>
</div>

<div class="check-item" id="v50-item">
<input type="checkbox" id="v50" onchange="updateCheck('v50')">
<label for="v50">Comprobar prÃ³xima ITB</label>
<button class="note-btn" onclick="openNoteModal('v50')">ğŸ“</button>
</div>

<div class="check-item" id="v51-item">
<input type="checkbox" id="v51" onchange="updateCheck('v51')">
<label for="v51">Hacer protocolo de servicio</label>
<button class="note-btn" onclick="openNoteModal('v51')">ğŸ“</button>
</div>

</div>
</div>

<div class="section">
<div class="section-title">Medidores</div>
<div class="medidores-section">

<div class="medidor-group">
<h4>âš“ MOTOR BABOR</h4>
<div class="medidor-item">
<label>RPM Babor</label>
<input type="text" id="mb0" placeholder="RPM">
</div>
<div class="medidor-item">
<label>Aceite Babor</label>
<input type="text" id="mb1" placeholder="Aceite">
</div>
<div class="medidor-item">
<label>Temperatura Babor</label>
<input type="text" id="mb2" placeholder="Â°C">
</div>
<div class="medidor-item">
<label>Voltaje Babor</label>
<input type="text" id="mb3" placeholder="V">
</div>
<div class="medidor-item">
<label>Tank Babor</label>
<input type="text" id="mb4" placeholder="Combustible">
</div>
</div>

<div class="medidor-group">
<h4>âš“ MOTOR ESTRIBOR</h4>
<div class="medidor-item">
<label>RPM Estribor</label>
<input type="text" id="me0" placeholder="RPM">
</div>
<div class="medidor-item">
<label>Aceite Estribor</label>
<input type="text" id="me1" placeholder="Aceite">
</div>
<div class="medidor-item">
<label>Temperatura Estribor</label>
<input type="text" id="me2" placeholder="Â°C">
</div>
<div class="medidor-item">
<label>Voltaje Estribor</label>
<input type="text" id="me3" placeholder="V">
</div>
<div class="medidor-item">
<label>Tank Estribor</label>
<input type="text" id="me4" placeholder="Combustible">
</div>
</div>

<div class="medidor-group">
<h4>âš“ MOTOR CENTRAL</h4>
<div class="medidor-item">
<label>RPM Central</label>
<input type="text" id="mc0" placeholder="RPM">
</div>
<div class="medidor-item">
<label>Aceite Central</label>
<input type="text" id="mc1" placeholder="Aceite">
</div>
<div class="medidor-item">
<label>Temperatura Central</label>
<input type="text" id="mc2" placeholder="Â°C">
</div>
<div class="medidor-item">
<label>Voltaje Central</label>
<input type="text" id="mc3" placeholder="V">
</div>
<div class="medidor-item">
<label>Tank Central</label>
<input type="text" id="mc4" placeholder="Combustible">
</div>
</div>

</div>
</div>

<div class="section">
<div class="section-title">Horas de NavegaciÃ³n</div>
<div class="form-row">
<div class="form-group">
<label>Horas Motor Babor</label>
<input type="text" id="horas-babor" placeholder="Horas">
</div>
<div class="form-group">
<label>Horas Motor Estribor</label>
<input type="text" id="horas-estribor" placeholder="Horas">
</div>
<div class="form-group">
<label>Horas Motor Central</label>
<input type="text" id="horas-central" placeholder="Horas">
</div>
<div class="form-group">
<label>Horas Generador</label>
<input type="text" id="horas-generador" placeholder="Horas">
</div>
</div>
</div>

<div class="section">
<div class="section-title">Observaciones Generales</div>
<textarea id="observaciones" maxlength="1000" rows="5" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;font-family:Arial,sans-serif" placeholder="Escribe observaciones generales aquÃ­..." oninput="updateCharCounter()"></textarea>
<div class="char-counter"><span id="char-count">0</span> / 1000 caracteres</div>
</div>

<div id="photo-report-section" class="photo-section" style="display:none">
<div class="section">
<div class="section-title">Reportaje FotogrÃ¡fico (Solo Varada)</div>
<div class="photo-grid">
<div class="photo-item" id="photo-f0-item">
<input type="file" id="photo-f0" accept="image/*" onchange="handlePhoto('f0')">
<label for="photo-f0">ğŸ“· Foto Proa</label>
<div id="preview-f0"></div>
</div>
<div class="photo-item" id="photo-f1-item">
<input type="file" id="photo-f1" accept="image/*" onchange="handlePhoto('f1')">
<label for="photo-f1">ğŸ“· Foto Amura Babor</label>
<div id="preview-f1"></div>
</div>
<div class="photo-item" id="photo-f2-item">
<input type="file" id="photo-f2" accept="image/*" onchange="handlePhoto('f2')">
<label for="photo-f2">ğŸ“· Foto Amura Estribor</label>
<div id="preview-f2"></div>
</div>
<div class="photo-item" id="photo-f3-item">
<input type="file" id="photo-f3" accept="image/*" onchange="handlePhoto('f3')">
<label for="photo-f3">ğŸ“· Foto Aleta Babor</label>
<div id="preview-f3"></div>
</div>
<div class="photo-item" id="photo-f4-item">
<input type="file" id="photo-f4" accept="image/*" onchange="handlePhoto('f4')">
<label for="photo-f4">ğŸ“· Foto Aleta Estribor</label>
<div id="preview-f4"></div>
</div>
<div class="photo-item" id="photo-f5-item">
<input type="file" id="photo-f5" accept="image/*" onchange="handlePhoto('f5')">
<label for="photo-f5">ğŸ“· Foto Colas</label>
<div id="preview-f5"></div>
</div>
<div class="photo-item" id="photo-f6-item">
<input type="file" id="photo-f6" accept="image/*" onchange="handlePhoto('f6')">
<label for="photo-f6">ğŸ“· Foto Ejes/IPS</label>
<div id="preview-f6"></div>
</div>
</div>
</div>
</div>

<div id="message-area" class="message-area"></div>
<div class="loading" id="loading">â³ Procesando...</div>

<div class="buttons">
<button class="btn btn-primary" onclick="saveInspection()">ğŸ’¾ GUARDAR INSPECCIÃ“N</button>
<button class="btn btn-secondary" onclick="clearForm()">ğŸ—‘ï¸ LIMPIAR FORMULARIO</button>
<button class="btn btn-success" id="pdf-btn" style="display:none" onclick="generatePDF()">ğŸ“„ GENERAR PDF</button>
</div>

</div>

<div id="tab-historial" class="tab-content">
<div class="section">
<div class="section-title">Historial de Inspecciones</div>
<div id="history-list" class="history-list"></div>
</div>
</div>

</div>
</div>

<div id="noteModal" class="modal">
<div class="modal-content">
<span class="modal-close" onclick="closeNoteModal()">&times;</span>
<h2 id="modal-title"></h2>
<textarea id="modal-note" rows="5" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;margin:20px 0"></textarea>
<button class="btn btn-primary" onclick="saveNote()">Guardar</button>
<button class="btn btn-secondary" onclick="closeNoteModal()">Cancelar</button>
</div>
</div>

<script>
var SCRIPT_URL='https://script.google.com/macros/s/AKfycbwFFeLOkABE1SqXsnEd37Hq5dPeqSd7f46dNPQVS3mF2VdzNFbyRDmBUtVkAa-jjpvsFA/exec';
var currentUser=null;
var currentInspType='';
var lastVarada=null;
var varadaRef={check:{},gauges:{},notes:{}};
var data={checklistPrevio:{},verificaciones:{},notas:{},medidoresBabor:{},medidoresEstribor:{},medidoresCentral:{},photoReport:{},alerts:{}};
var currentNoteId='';

// ========== FUNCIONES PRINCIPALES ==========

function login(){
var user=document.getElementById('username').value;
var pass=document.getElementById('password').value;
if(!user||!pass){showMsg('login-message','Usuario y contraseÃ±a requeridos','error');return}
showLoading('Iniciando sesiÃ³n...');
fetch(SCRIPT_URL+'?action=login&username='+encodeURIComponent(user)+'&password='+encodeURIComponent(pass))
.then(r=>r.json())
.then(result=>{
hideLoading();
if(result.success){
currentUser=result.user.name;
document.getElementById('current-user').textContent=currentUser;
document.getElementById('login-section').style.display='none';
document.getElementById('main-section').style.display='block';
loadHistory();
}else{
showMsg('login-message',result.message||'Error de login','error');
}
}).catch(err=>{hideLoading();showMsg('login-message','Error de conexiÃ³n','error')});
}

function logout(){
currentUser=null;
document.getElementById('login-section').style.display='block';
document.getElementById('main-section').style.display='none';
document.getElementById('username').value='';
document.getElementById('password').value='';
clearForm();
}

function showTab(tab){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
event.target.classList.add('active');
document.getElementById('tab-'+tab).classList.add('active');
if(tab==='historial')loadHistory();
}

function checkVarada(){
var type=document.getElementById('inspection-type').value;
var boat=document.getElementById('boat-name').value.trim();
currentInspType=type;
document.getElementById('checklist-previo-section').style.display=type==='varada'?'block':'none';
document.getElementById('photo-report-section').style.display=type==='varada'?'block':'none';
if(!boat||!type)return;
showLoading('Buscando varada...');
fetch(SCRIPT_URL+'?action=getLastVarada&boat='+encodeURIComponent(boat))
.then(r=>r.json())
.then(result=>{
hideLoading();
if(result.success&&result.data){
lastVarada=result.data;
try{varadaRef.check=JSON.parse(lastVarada.verificacionesJson||'{}');}catch(e){varadaRef.check={};}
try{varadaRef.notes=JSON.parse(lastVarada.notasJson||'{}');}catch(e){varadaRef.notes={};}
try{varadaRef.gaugesBabor=JSON.parse(lastVarada.medidoresBaborJson||'{}');}catch(e){varadaRef.gaugesBabor={};}
try{varadaRef.gaugesEstribor=JSON.parse(lastVarada.medidoresEstribOrJson||'{}');}catch(e){varadaRef.gaugesEstribor={};}
try{varadaRef.gaugesCentral=JSON.parse(lastVarada.medidoresCentralJson||'{}');}catch(e){varadaRef.gaugesCentral={};}
var varadaDate=new Date(lastVarada.fecha);
var sixMonthsAgo=new Date();sixMonthsAgo.setMonth(sixMonthsAgo.getMonth()-6);
var isRecent=varadaDate>sixMonthsAgo;
var isActive=!lastVarada.cerrada;
var importSection=document.getElementById('import-section');
var html='<div class="import-alert">';
if(type==='varada'&&isActive&&isRecent){
html+='<h4>Varada Incompleta Encontrada</h4>';
html+='<p>Fecha: '+lastVarada.fecha+' - TÃ©cnico: '+lastVarada.tecnico+'</p>';
html+='<button class="import-btn" onclick="continuarVarada()">CONTINUAR VARADA ANTERIOR</button>';
}else if(type==='botadura'){
html+='<h4>Importar Varada</h4>';
html+='<p>Ãšltima varada: '+lastVarada.fecha+' - Estado: '+(isActive?'ACTIVA':'CERRADA')+'</p>';
html+='<button class="import-btn" onclick="importVarada()">IMPORTAR DATOS</button>';
}
html+='</div>';
importSection.innerHTML=html;
importSection.style.display='block';
}else{
document.getElementById('import-section').style.display='none';
lastVarada=null;
}
}).catch(err=>{hideLoading();document.getElementById('import-section').style.display='none'});
}

function continuarVarada(){
if(!lastVarada)return;
try{
var checkPrev=JSON.parse(lastVarada.checklistPrevioJson||'{}');
for(var k in checkPrev){if(checkPrev[k])document.getElementById(k).checked=true;}
}catch(e){}
try{
var verif=JSON.parse(lastVarada.verificacionesJson||'{}');
for(var k in verif){if(verif[k])document.getElementById(k).checked=true;}
}catch(e){}
try{
var notas=JSON.parse(lastVarada.notasJson||'{}');
data.notas=notas;
for(var k in notas){
if(notas[k]){
var item=document.getElementById(k+'-item');
if(item)item.classList.add('with-note');
}
}
}catch(e){}
try{
var medB=JSON.parse(lastVarada.medidoresBaborJson||'{}');
for(var k in medB){var el=document.getElementById(k);if(el)el.value=medB[k]||'';}
}catch(e){}
try{
var medE=JSON.parse(lastVarada.medidoresEstribOrJson||'{}');
for(var k in medE){var el=document.getElementById(k);if(el)el.value=medE[k]||'';}
}catch(e){}
try{
var medC=JSON.parse(lastVarada.medidoresCentralJson||'{}');
for(var k in medC){var el=document.getElementById(k);if(el)el.value=medC[k]||'';}
}catch(e){}
document.getElementById('modelo').value=lastVarada.modelo||'';
document.getElementById('cliente').value=lastVarada.cliente||'';
document.getElementById('motores').value=lastVarada.motores||'';
document.getElementById('colas').value=lastVarada.colas||'';
document.getElementById('motor-babor').value=lastVarada.motorBabor||'';
document.getElementById('motor-estribor').value=lastVarada.motorEstribor||'';
document.getElementById('motor-central').value=lastVarada.motorCentral||'';
document.getElementById('motor-aux-num').value=lastVarada.motorAuxiliarNum||'';
document.getElementById('motor-aux-modelo').value=lastVarada.motorAuxiliarModelo||'';
document.getElementById('llaves').value=lastVarada.llaves||'';
document.getElementById('cabina').value=lastVarada.cabina||'';
document.getElementById('amarre').value=lastVarada.amarre||'';
document.getElementById('paso-helice').value=lastVarada.pasoHelice||'';
document.getElementById('horas-babor').value=lastVarada.horasBabor||'';
document.getElementById('horas-estribor').value=lastVarada.horasEstribor||'';
document.getElementById('horas-central').value=lastVarada.horasCentral||'';
document.getElementById('horas-generador').value=lastVarada.horasGenerador||'';
document.getElementById('observaciones').value=lastVarada.observaciones||'';
updateCharCounter();
showMsg('message-area','Varada cargada. Puedes continuar trabajando.','success');
document.getElementById('import-section').style.display='none';
}

function importVarada(){
if(!lastVarada)return;
try{
var notas=JSON.parse(lastVarada.notasJson||'{}');
data.notas=notas;
for(var k in notas){
if(notas[k]){
var item=document.getElementById(k+'-item');
if(item)item.classList.add('imported');
}
}
}catch(e){}
try{
var medB=JSON.parse(lastVarada.medidoresBaborJson||'{}');
for(var k in medB){var el=document.getElementById(k);if(el)el.value=medB[k]||'';}
}catch(e){}
try{
var medE=JSON.parse(lastVarada.medidoresEstribOrJson||'{}');
for(var k in medE){var el=document.getElementById(k);if(el)el.value=medE[k]||'';}
}catch(e){}
try{
var medC=JSON.parse(lastVarada.medidoresCentralJson||'{}');
for(var k in medC){var el=document.getElementById(k);if(el)el.value=medC[k]||'';}
}catch(e){}
document.getElementById('modelo').value=lastVarada.modelo||'';
document.getElementById('cliente').value=lastVarada.cliente||'';
document.getElementById('motores').value=lastVarada.motores||'';
document.getElementById('colas').value=lastVarada.colas||'';
document.getElementById('motor-babor').value=lastVarada.motorBabor||'';
document.getElementById('motor-estribor').value=lastVarada.motorEstribor||'';
document.getElementById('motor-central').value=lastVarada.motorCentral||'';
document.getElementById('motor-aux-num').value=lastVarada.motorAuxiliarNum||'';
document.getElementById('motor-aux-modelo').value=lastVarada.motorAuxiliarModelo||'';
document.getElementById('llaves').value=lastVarada.llaves||'';
document.getElementById('cabina').value=lastVarada.cabina||'';
document.getElementById('amarre').value=lastVarada.amarre||'';
document.getElementById('paso-helice').value=lastVarada.pasoHelice||'';
showMsg('message-area','Datos de varada importados (sin checks marcados)','success');
document.getElementById('import-section').style.display='none';
}

function updateCheck(id){
data[id.startsWith('cp')?'checklistPrevio':'verificaciones'][id]=document.getElementById(id).checked;
}

function openNoteModal(id){
currentNoteId=id;
var itemText=document.querySelector('label[for="'+id+'"]').textContent;
document.getElementById('modal-title').textContent='Nota: '+itemText;
document.getElementById('modal-note').value=data.notas[id]||'';
if(varadaRef.gaugesBabor&&varadaRef.gaugesBabor[id]){
document.getElementById('modal-note').value+='\n[VARADA] Medidor Babor: '+varadaRef.gaugesBabor[id];
}
if(varadaRef.gaugesEstribor&&varadaRef.gaugesEstribor[id]){
document.getElementById('modal-note').value+='\n[VARADA] Medidor Estribor: '+varadaRef.gaugesEstribor[id];
}
if(varadaRef.gaugesCentral&&varadaRef.gaugesCentral[id]){
document.getElementById('modal-note').value+='\n[VARADA] Medidor Central: '+varadaRef.gaugesCentral[id];
}
document.getElementById('noteModal').style.display='block';
}

function closeNoteModal(){
document.getElementById('noteModal').style.display='none';
}

function saveNote(){
var note=document.getElementById('modal-note').value.trim();
data.notas[currentNoteId]=note;
var item=document.getElementById(currentNoteId+'-item');
if(note){item.classList.add('with-note');}else{item.classList.remove('with-note');}
closeNoteModal();
}

function handlePhoto(id){
var input=document.getElementById('photo-'+id);
var file=input.files[0];
if(!file)return;
var reader=new FileReader();
reader.onload=function(e){
if(!data.photoReport[id])data.photoReport[id]=[];
data.photoReport[id]=[e.target.result];
var preview=document.getElementById('preview-'+id);
preview.innerHTML='<img src="'+e.target.result+'" class="photo-preview"><button class="photo-remove" onclick="removePhoto(\''+id+'\')">Ã—</button>';
document.getElementById('photo-'+id+'-item').classList.add('has-photo');
};
reader.readAsDataURL(file);
}

function removePhoto(id){
data.photoReport[id]=[];
document.getElementById('preview-'+id).innerHTML='';
document.getElementById('photo-'+id).value='';
document.getElementById('photo-'+id+'-item').classList.remove('has-photo');
}

function updateCharCounter(){
var count=document.getElementById('observaciones').value.length;
document.getElementById('char-count').textContent=count;
}

function saveInspection(){
var boat=document.getElementById('boat-name').value.trim();
var type=document.getElementById('inspection-type').value;
if(!boat||!type){showMsg('message-area','EmbarcaciÃ³n y tipo son obligatorios','error');return}
// Recoger medidores
data.medidoresBabor={};
data.medidoresEstribor={};
data.medidoresCentral={};
for(var i=0;i<5;i++){
var mb=document.getElementById('mb'+i);if(mb&&mb.value)data.medidoresBabor['mb'+i]=mb.value;
var me=document.getElementById('me'+i);if(me&&me.value)data.medidoresEstribor['me'+i]=me.value;
var mc=document.getElementById('mc'+i);if(mc&&mc.value)data.medidoresCentral['mc'+i]=mc.value;
}
var inspData={
fecha:new Date().toISOString(),
tecnico:currentUser,
embarcacion:boat,
modelo:document.getElementById('modelo').value,
tipo:type,
cliente:document.getElementById('cliente').value,
motores:document.getElementById('motores').value,
colas:document.getElementById('colas').value,
motorBabor:document.getElementById('motor-babor').value,
motorEstribor:document.getElementById('motor-estribor').value,
motorCentral:document.getElementById('motor-central').value,
motorAuxiliarNum:document.getElementById('motor-aux-num').value,
motorAuxiliarModelo:document.getElementById('motor-aux-modelo').value,
llaves:document.getElementById('llaves').value,
cabina:document.getElementById('cabina').value,
amarre:document.getElementById('amarre').value,
pasoHelice:document.getElementById('paso-helice').value,
fechaVarada:document.getElementById('date-varada').value,
fechaBotadura:document.getElementById('date-botadura').value,
horasBabor:document.getElementById('horas-babor').value,
horasEstribor:document.getElementById('horas-estribor').value,
horasCentral:document.getElementById('horas-central').value,
horasGenerador:document.getElementById('horas-generador').value,
observaciones:document.getElementById('observaciones').value,
checklistPrevio:data.checklistPrevio,
verificaciones:data.verificaciones,
notas:data.notas,
medidoresBabor:data.medidoresBabor,
medidoresEstribor:data.medidoresEstribor,
medidoresCentral:data.medidoresCentral,
photoReport:data.photoReport,
varadaImportada:lastVarada?lastVarada.id:''
};
showLoading('Guardando...');
fetch(SCRIPT_URL,{
method:'POST',
body:JSON.stringify({action:'save',data:inspData})
})
.then(r=>r.json())
.then(result=>{
hideLoading();
if(result.success){
showMsg('message-area','âœ… InspecciÃ³n guardada correctamente. Email enviado.','success');
document.getElementById('pdf-btn').style.display='inline-block';
}else{
showMsg('message-area','Error: '+result.message,'error');
}
}).catch(err=>{hideLoading();showMsg('message-area','Error de conexiÃ³n','error')});
}

function clearForm(){
document.querySelectorAll('input[type="text"],input[type="date"],textarea,select').forEach(e=>e.value='');
document.querySelectorAll('input[type="checkbox"]').forEach(e=>e.checked=false);
document.querySelectorAll('.check-item').forEach(e=>e.classList.remove('with-note','imported'));
for(var i=0;i<7;i++)removePhoto('f'+i);
data={checklistPrevio:{},verificaciones:{},notas:{},medidoresBabor:{},medidoresEstribor:{},medidoresCentral:{},photoReport:{},alerts:{}};
lastVarada=null;
document.getElementById('import-section').style.display='none';
document.getElementById('pdf-btn').style.display='none';
updateCharCounter();
}

function loadHistory(){
showLoading('Cargando historial...');
fetch(SCRIPT_URL+'?action=getHistory&user='+currentUser)
.then(r=>r.json())
.then(result=>{
hideLoading();
if(result.success){
var html='';
result.data.forEach(item=>{
html+='<div class="history-item '+(item.cerrada?'cerrada':'')+'">';
html+='<div class="history-date">'+item.fecha+'</div>';
html+='<div class="history-info">'+item.embarcacion+' - '+item.tipo.toUpperCase()+'<br>Cliente: '+(item.cliente||'N/A')+'</div>';
html+='<button class="history-btn" onclick="verInspeccion(\''+item.id+'\')">VER</button>';
html+='<button class="history-btn" onclick="generatePDFFromHistory(\''+item.id+'\')">PDF</button>';
html+='</div>';
});
document.getElementById('history-list').innerHTML=html||'<p>No hay inspecciones</p>';
}
}).catch(err=>{hideLoading();});
}

function verInspeccion(id){
showLoading('Cargando...');
fetch(SCRIPT_URL+'?action=getInspection&id='+id)
.then(r=>r.json())
.then(result=>{
hideLoading();
if(result.success){
var insp=result.data;
document.getElementById('boat-name').value=insp.embarcacion;
document.getElementById('modelo').value=insp.modelo||'';
document.getElementById('inspection-type').value=insp.tipo;
document.getElementById('cliente').value=insp.cliente||'';
document.getElementById('motores').value=insp.motores||'';
document.getElementById('colas').value=insp.colas||'';
document.getElementById('motor-babor').value=insp.motorBabor||'';
document.getElementById('motor-estribor').value=insp.motorEstribor||'';
document.getElementById('motor-central').value=insp.motorCentral||'';
document.getElementById('motor-aux-num').value=insp.motorAuxiliarNum||'';
document.getElementById('motor-aux-modelo').value=insp.motorAuxiliarModelo||'';
document.getElementById('llaves').value=insp.llaves||'';
document.getElementById('cabina').value=insp.cabina||'';
document.getElementById('amarre').value=insp.amarre||'';
document.getElementById('paso-helice').value=insp.pasoHelice||'';
document.getElementById('date-varada').value=insp.fechaVarada||'';
document.getElementById('date-botadura').value=insp.fechaBotadura||'';
document.getElementById('horas-babor').value=insp.horasBabor||'';
document.getElementById('horas-estribor').value=insp.horasEstribor||'';
document.getElementById('horas-central').value=insp.horasCentral||'';
document.getElementById('horas-generador').value=insp.horasGenerador||'';
document.getElementById('observaciones').value=insp.observaciones||'';
try{var cp=JSON.parse(insp.checklistPrevioJson||'{}');for(var k in cp){var el=document.getElementById(k);if(el)el.checked=cp[k];}}catch(e){}
try{var v=JSON.parse(insp.verificacionesJson||'{}');for(var k in v){var el=document.getElementById(k);if(el)el.checked=v[k];}}catch(e){}
try{var n=JSON.parse(insp.notasJson||'{}');data.notas=n;for(var k in n){if(n[k])document.getElementById(k+'-item').classList.add('with-note');}}catch(e){}
try{var mb=JSON.parse(insp.medidoresBaborJson||'{}');for(var k in mb){var el=document.getElementById(k);if(el)el.value=mb[k];}}catch(e){}
try{var me=JSON.parse(insp.medidoresEstribOrJson||'{}');for(var k in me){var el=document.getElementById(k);if(el)el.value=me[k];}}catch(e){}
try{var mc=JSON.parse(insp.medidoresCentralJson||'{}');for(var k in mc){var el=document.getElementById(k);if(el)el.value=mc[k];}}catch(e){}
updateCharCounter();
showTab('nueva');
showMsg('message-area','InspecciÃ³n cargada','success');
}else{
showMsg('message-area','Error: '+result.message,'error');
}
}).catch(err=>{hideLoading();showMsg('message-area','Error de conexiÃ³n','error')});
}

function generatePDF(){alert('FunciÃ³n PDF en desarrollo');}
function generatePDFFromHistory(id){alert('FunciÃ³n PDF en desarrollo');}
function showLoading(msg){document.getElementById('loading').textContent=msg||'Procesando...';document.getElementById('loading').style.display='block';}
function hideLoading(){document.getElementById('loading').style.display='none';}
function showMsg(id,msg,type){var el=document.getElementById(id);el.textContent=msg;el.className='message-area '+type;el.style.display='block';setTimeout(()=>el.style.display='none',5000);}

</script>
</body>
</html>
